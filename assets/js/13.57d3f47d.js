(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{409:function(e,s,t){"use strict";t.r(s);var a=t(50),r=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("使用虚拟机，VPS，或者其他 Ubuntu 机器编译 OpenWRT")]),e._v(" "),t("h2",{attrs:{id:"视频教程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#视频教程"}},[e._v("#")]),e._v(" 视频教程")]),e._v(" "),t("bilibili",{attrs:{bvid:"BV1CV4111723",page:1,highQuality:!0,danmaku:!0}}),e._v(" "),t("h2",{attrs:{id:"说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[e._v("#")]),e._v(" 说明")]),e._v(" "),t("p",[e._v("如果没有特殊需求，直接下载别人编译好的文件即可，我自己编译的固件可以在我的 "),t("a",{attrs:{href:"https://dl.u2sb.top/#/s/GPIQ?path=%2Fblog%2F%E8%BD%AF%E8%B7%AF%E7%94%B1%2FOpenWRT%2F%E8%87%AA%E5%B7%B1%E7%BC%96%E8%AF%91%E7%9A%84%E9%95%9C%E5%83%8F",target:"_blank",rel:"noopener noreferrer"}},[e._v("网盘"),t("OutboundLink")],1),e._v(" 下载。学习编译固件并不一定是为了自己使用，而是去了解这个过程，开阔视野，说白了就是涨姿势。")]),e._v(" "),t("h2",{attrs:{id:"准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[e._v("#")]),e._v(" 准备工作")]),e._v(" "),t("p",[e._v("需要 1 个可以正常联网的 Ubuntu 系统，推荐大家使用虚拟机安装 Ubuntu 18 LTS x64，Ubuntu 镜像可以到这里"),t("a",{attrs:{href:"https://mirrors.huaweicloud.com/ubuntu-cdimage/releases/18.04.4/release/",target:"_blank",rel:"noopener noreferrer"}},[e._v("下载"),t("OutboundLink")],1),e._v("，使用 Server 版即可。")]),e._v(" "),t("p",[e._v("使用虚拟机的话，磁盘空间要足够大，建议给 50G 以上的磁盘空间。")]),e._v(" "),t("p",[e._v("不知道怎么安装的话，可以参考我的 "),t("a",{attrs:{href:"https://www.bilibili.com/video/BV1S7411q7hv",target:"_blank",rel:"noopener noreferrer"}},[e._v("Linux 学习教程"),t("OutboundLink")],1),e._v("，当然仅仅是参考，Ubuntu 和 Debian 安装过程有 90% 以上的相似程度。")]),e._v(" "),t("p",[e._v("需要下载大量依赖文件，所以请备好梯子，至于 Ubuntu 怎么全局代理，请大家各显神通，自行百度。")]),e._v(" "),t("p",[e._v("一个 ssh 终端工具，这一次我就使用 "),t("a",{attrs:{href:"https://code.visualstudio.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("vscode"),t("OutboundLink")],1),e._v("，配合插件 "),t("a",{attrs:{href:"https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh",target:"_blank",rel:"noopener noreferrer"}},[e._v("Remote - SSH"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("p",[e._v("设置好 ssh 免密登录，然后连接上服务器。注意，一定要用非 root 用户登录，千万不要用 root 用户。")]),e._v(" "),t("p",[e._v("记得一定要调整时区和时间。")]),e._v(" "),t("p",[e._v("换好国内源，比如华为开源镜像站")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('sudo sed -i "s@http://.*archive.ubuntu.com@http://mirrors.huaweicloud.com@g" /etc/apt/sources.list\nsudo sed -i "s@http://.*security.ubuntu.com@http://mirrors.huaweicloud.com@g" /etc/apt/sources.list\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[e._v("更新一下系统")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo apt update\nsudo apt dist-upgrade\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("h2",{attrs:{id:"仓库和依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#仓库和依赖"}},[e._v("#")]),e._v(" 仓库和依赖")]),e._v(" "),t("p",[e._v("要编译的是大雕的固件，直接看他的要求 https://github.com/coolsnowwolf/lede")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo apt-get update\n\nsudo apt-get -y install build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch python3.5 python2.7 unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs git-core gcc-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler g++-multilib antlr3 gperf wget swig\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("p",[e._v("然后克隆仓库")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("mkdir openwrt\ncd openwrt\ngit clone https://github.com/coolsnowwolf/lede\ncd lede\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("p",[e._v("如果你的网络环境不好的话，这一步可能会非常耗时。")]),e._v(" "),t("p",[e._v("然后是一些其他的软件包，编辑  "),t("code",[e._v("feeds.conf.default")]),e._v(" ，添加")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("src-git kenzo https://github.com/kenzok8/openwrt-packages\nsrc-git small https://github.com/kenzok8/small\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("blockquote",[t("p",[e._v("我选择 vscode 的原因就是，编辑文件方便")])]),e._v(" "),t("p",[e._v("然后运行命令")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("./scripts/feeds update -a\n./scripts/feeds install -a\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("h2",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[e._v("#")]),e._v(" 配置")]),e._v(" "),t("p",[e._v("运行命令")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("make menuconfig\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("就可以弹出菜单界面了，如果有其他人编译的配置文件，可以使用导入功能导入。")]),e._v(" "),t("p",[e._v("配置说明  "),t("code",[e._v("*")]),e._v("  标记会编译进固件中， "),t("code",[e._v("M")]),e._v("  标记会编译成软件包，使用空格切换标记。")]),e._v(" "),t("p",[e._v("下面的一行  "),t("code",[e._v("Select")]),e._v("  是选择，可以进入下一级菜单， "),t("code",[e._v("Exit")]),e._v("  是退出，可以返回上一级菜单， "),t("code",[e._v("Help")]),e._v("  是帮助， "),t("code",[e._v("Save")]),e._v("  是保存， "),t("code",[e._v("Load")]),e._v("  是加载，可以导入编译配置文件。原则上是不懂不要改，不懂不要改，不懂不要改，不要贪多，不要贪多，不要贪多。")]),e._v(" "),t("p",[e._v("其中  "),t("code",[e._v("Base System")]),e._v("  和  "),t("code",[e._v("Administration")]),e._v(" ，如果没有特殊需求，请不要修改。")]),e._v(" "),t("p",[t("code",[e._v("Kernel modules")]),e._v("  和  "),t("code",[e._v("Firmware")]),e._v("  是配置内核和驱动的地方，像 PCIE 支持，USB 设备支持，还有无线网卡驱动支持，反正这里面的东西就是，不懂不要改。")]),e._v(" "),t("p",[t("code",[e._v("Libraries")]),e._v("  是配置库的地方，这里面都是一些运行库，一般不需要单独去勾选某一个。")]),e._v(" "),t("p",[t("code",[e._v("LuCI")]),e._v("  是最主要需要配置的地方，大部分的软件都是在这里面配置的。勾选上需要的即可，不要贪多。有些软件本身就是冲突的，不知道的不要选。")]),e._v(" "),t("p",[t("code",[e._v("Multimedia")]),e._v("  是媒体相关的东西，大部分人都用不到。")]),e._v(" "),t("p",[t("code",[e._v("Network")]),e._v("  是网络相关的东西。")]),e._v(" "),t("p",[e._v("配置项里面，每一项都要按照他自己的文档去做，不要自己瞎搞，看文档，看注意事项，看依赖，看冲突。不要贪多，不懂的不要搞，每一项都够学习很长时间的，我都用了这么久了，能看懂怎么搞的，直接就能认出来是做什么的包，也只有很少一部分，大部分包都是不知道做什么的。")]),e._v(" "),t("h2",{attrs:{id:"编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[e._v("#")]),e._v(" 编译")]),e._v(" "),t("h3",{attrs:{id:"第一次编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一次编译"}},[e._v("#")]),e._v(" 第一次编译")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("make -j8 download V=s\nmake -j1 V=s\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[t("code",[e._v("-j")]),e._v("  后面的为线程数，推荐第一次使用单线程编译，否则你编译错误，连调试信息都没有，根本不知道哪里错的。")]),e._v(" "),t("p",[e._v("编译完成后输出路径：/lede/bin/targets")]),e._v(" "),t("p",[e._v("单线程编译一次大概需要 3-5 个小时，具体要看电脑配置和需要编译的插件数量")]),e._v(" "),t("h3",{attrs:{id:"重新编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重新编译"}},[e._v("#")]),e._v(" 重新编译")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("cd lede\ngit pull\n./scripts/feeds update -a && ./scripts/feeds install -a\nmake defconfig\nmake -j8 download\nmake -j$(($(nproc) + 1)) V=s\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br")])]),t("h3",{attrs:{id:"重新配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重新配置"}},[e._v("#")]),e._v(" 重新配置")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("rm -rf ./tmp && rm -rf .config\nmake menuconfig\nmake -j8 download V=s\nmake -j$(($(nproc) + 1)) V=s\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("h2",{attrs:{id:"解决错误"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决错误"}},[e._v("#")]),e._v(" 解决错误")]),e._v(" "),t("p",[e._v("看输出，哪里报错了，报错的是哪个插件，简单翻译一下是什么问题，不懂就把报错那句话复制到 google 里面搜索。更简单的解决办法是搜 "),t("a",{attrs:{href:"https://github.com/coolsnowwolf/lede/issues",target:"_blank",rel:"noopener noreferrer"}},[e._v("issues"),t("OutboundLink")],1),e._v("，看看以前有没有人遇到一样的问题，有什么解决方案。")])],1)}),[],!1,null,null,null);s.default=r.exports}}]);