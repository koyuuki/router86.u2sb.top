(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{405:function(s,t,a){"use strict";a.r(t);var e=a(50),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("这一篇文章讲怎么让 OMV 系统拥有冗余功能。也就是在 raid 上安装 OMV 系统，坏掉任意一块硬盘的情况下，系统照样能启动。")]),s._v(" "),a("h2",{attrs:{id:"准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[s._v("#")]),s._v(" 准备")]),s._v(" "),a("blockquote",[a("p",[s._v("本文所用镜像为  "),a("code",[s._v("debian-10.5.0-amd64-netinst.iso")])])]),s._v(" "),a("blockquote",[a("p",[s._v("注意，演示所用环境，启动方式为 UEFI，非 secure boot，硬盘协议为 SATA，需要空间，10G 以上，推荐 60G 或更大空间。安装之前推荐将机器连接网络。")])]),s._v(" "),a("blockquote",[a("p",[s._v("最好有 Linux 安装经验，看到英文不要慌，遇到和文章里不一样的，或者是看不懂的，尝试去翻译一下。每张图具体是什么意思，翻译一下图上的英文就能看懂，这个真的不难，我这个四级没过的废物都能看得懂。")])]),s._v(" "),a("p",[s._v("这一次我们需要从 Debian 安装 OMV，所以需要一个 Debian10 的镜像，可以在"),a("a",{attrs:{href:"https://mirrors.huaweicloud.com/debian-cd/",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),a("OutboundLink")],1),s._v("下载。")]),s._v(" "),a("p",[s._v("本文目的是讲 Debian 安装在 raid1 上，并在每个硬盘上安装引导，做的在任意一块硬盘损坏的情况下，系统均能正常启动。")]),s._v(" "),a("h2",{attrs:{id:"视频教程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视频教程"}},[s._v("#")]),s._v(" 视频教程")]),s._v(" "),a("bilibili",{attrs:{bvid:"BV1Hh411R7iD",page:1,highQuality:!0,danmaku:!0}}),s._v(" "),a("h2",{attrs:{id:"安装-debian"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-debian"}},[s._v("#")]),s._v(" 安装 Debian")]),s._v(" "),a("p",[s._v("请确保系统插入了两块以上的硬盘用于安装系统盘，接下来跟我我的讲解进入安装步骤。")]),s._v(" "),a("p",[s._v("首先进入图形化安装界面，语言选择英文即可。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-34-19.png",alt:"安装界面"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-34-31.png",alt:"语言选择"}})]),s._v(" "),a("p",[s._v("区域选择中国，键盘选择美式键盘。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-34-37.png",alt:"区域和键盘"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-35-01.png",alt:"区域和键盘"}})]),s._v(" "),a("p",[s._v("再接下来是网络设置，下面两张图填写的是主机名，这里根据你自己的实际情况填写，不懂的话默认即可，不需要修改。如果你的机器没有联网，会让你手动设置，这个时候跳过即可。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-38-37.png",alt:"网络设置"}})]),s._v(" "),a("p",[s._v("接下来输入 root 密码。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-39-09.png",alt:"输入root密码"}})]),s._v(" "),a("p",[s._v("再接下来创建一个新用户。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-39-14.png",alt:"创建新用户"}})]),s._v(" "),a("p",[s._v("然后是硬盘部分，这是这篇文章的重点之一，这里选择手动分区。")]),s._v(" "),a("p",[s._v("先创建好分区表，选择对应的硬盘，直接回车即可创建。注意这会清空硬盘里原有的分区，并且会清空数据。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-40-41.png",alt:"创建好分区表"}})]),s._v(" "),a("p",[s._v("然后创建一个 EFI 分区，不用太大，够用就行，你如果嫌小，可以自己改大一点。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-40-47.png",alt:"创建EFI分区"}})]),s._v(" "),a("p",[s._v("对另一块硬盘做相同的操作，两块硬盘最好是完全一致。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-41-54.png",alt:"另一块硬盘"}})]),s._v(" "),a("p",[s._v("然后开始创建软 raid，过程可以看图，看不懂的简单翻译一下就明白了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-42-00.png",alt:"创建软raid"}})]),s._v(" "),a("p",[s._v("两块硬盘都选上，空闲 0 块。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-42-23.png",alt:"创建软raid"}})]),s._v(" "),a("p",[s._v("选择未分区的两个位置，创建软 raid。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-42-42.png",alt:"创建软raid"}})]),s._v(" "),a("p",[s._v("然后为创建出来的软 raid 分区，这里演示只有一个分区，没有必要按照网上教程分那么多区，然后分目录去挂载，一个就可以。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-43-21.png",alt:"软raid分区"}})]),s._v(" "),a("p",[s._v("然后确定不要 swap 分区，并且确定分区的更改。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-43-59.png",alt:"确定分区更改"}})]),s._v(" "),a("p",[s._v("确定不插入其他 CD。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-48-04.png",alt:"CD"}})]),s._v(" "),a("p",[s._v("选择合适的镜像源，这里选你认为最快的。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-48-15.png",alt:"选择镜像源"}})]),s._v(" "),a("p",[s._v("选择需要安装的服务。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-48-53.png",alt:"需要安装的服务"}})]),s._v(" "),a("p",[s._v("最后等安装完成，重启应该就可以进入系统。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-16-51-30.png",alt:"安装完成"}})]),s._v(" "),a("h2",{attrs:{id:"创建另一个启动项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建另一个启动项"}},[s._v("#")]),s._v(" 创建另一个启动项")]),s._v(" "),a("p",[s._v("这样虽然把系统安装在了 raid1 上，但是引导只安装在了一块硬盘上，如果引导所在的硬盘挂了，那系统照样是会挂的。")]),s._v(" "),a("p",[s._v("接下来需要安装另一个启动引导。")]),s._v(" "),a("p",[s._v("登录系统，输入")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ip addr\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("查看当前 ip。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/OMV-2020-08-26-17-27-02.png",alt:"查看ip"}})]),s._v(" "),a("p",[s._v("然后远程登录上去。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ssh mc@192.168.91.136\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后切换到 root 用户，安装一些必要的软件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("su\n\napt update\napt install sudo vim net-tools efibootmgr\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("将 mc 添加进 sudo 用户组")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/sbin/usermod -a -G sudo mc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后关掉 ssh 连接，重新登录一遍。")]),s._v(" "),a("p",[s._v("输入")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("df -h\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://blog.xxwhite.com/assets/img/2020/08/200826_173142_WindowsTerminal_iMc2.png",alt:"查看磁盘"}})]),s._v(" "),a("p",[s._v("可以看到  "),a("code",[s._v("/dev/sda1")]),s._v("  是当前的 efi 磁盘，需要克隆到  "),a("code",[s._v("/dev/sdb1")]),s._v("  上（这个需要自行判断实际情况）。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo dd if=/dev/sda1 of=/dev/sdb1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后创建新的引导项（下面的命令需要你根据实际情况自行修改）。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo efibootmgr -c -g -d /dev/sdb -p 1 -L \"debian #2\" -l '\\EFI\\debian\\shimx64.efi'\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),a("p",[s._v("然后重启看一下是不是有了一个启动项  "),a("code",[s._v("debian #2")]),s._v(" ，尝试一下用这个启动项启动系统，然后再尝试分别拔掉两块硬盘，系统能否正常启动。")]),s._v(" "),a("h2",{attrs:{id:"安装-omv"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-omv"}},[s._v("#")]),s._v(" 安装 OMV")]),s._v(" "),a("blockquote",[a("p",[s._v("建议：安装 OMV 之前将  "),a("code",[s._v("security.debian.org")]),s._v("  也替换掉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('sed -i "s@http://security.debian.org@https://mirrors.huaweicloud.com@g" /etc/apt/sources.list\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("p",[s._v("首先将系统更新到最新")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo apt-get update\nsudo apt-get dist-upgrade\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("添加密钥")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('sudo apt-get install --yes gnupg\nsudo wget -O "/etc/apt/trusted.gpg.d/openmediavault-archive-keyring.asc" https://packages.openmediavault.org/public/archive.key\nsudo apt-key add "/etc/apt/trusted.gpg.d/openmediavault-archive-keyring.asc"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("添加软件源")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo vim /etc/apt/sources.list.d/openmediavault.list\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("写入内容为：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("deb https://packages.openmediavault.org/public usul main\n# deb https://downloads.sourceforge.net/project/openmediavault/packages usul main\n## Uncomment the following line to add software from the proposed repository.\ndeb https://packages.openmediavault.org/public usul-proposed main\n# deb https://downloads.sourceforge.net/project/openmediavault/packages usul-proposed main\n## This software is not part of OpenMediaVault, but is offered by third-party\n## developers as a service to OpenMediaVault users.\n# deb https://packages.openmediavault.org/public usul partner\n# deb https://downloads.sourceforge.net/project/openmediavault/packages usul partner\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("然后安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('export LANG=C.UTF-8\nexport DEBIAN_FRONTEND=noninteractive\nexport APT_LISTCHANGES_FRONTEND=none\n\nsudo apt-get update\nsudo apt-get --yes --auto-remove --show-upgraded \\\n    --allow-downgrades --allow-change-held-packages \\\n    --no-install-recommends \\\n    --option Dpkg::Options::="--force-confdef" \\\n    --option DPkg::Options::="--force-confold" \\\n    install openmediavault-keyring openmediavault\n\nsudo omv-confdbadm populate\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("中间遇到什么需要让你手动选择的，全都是默认选项即可。")]),s._v(" "),a("p",[s._v("然后在浏览器输入机器的 ip 或者是 "),a("code",[s._v("debian/")]),s._v("  即可访问后台网络面板。")]),s._v(" "),a("p",[s._v("至于硬盘坏了怎么恢复，会在以后的文章中讲到。")]),s._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://wiki.debian.org/DebianInstaller/SoftwareRaidRoot",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://wiki.debian.org/DebianInstaller/SoftwareRaidRoot"),a("OutboundLink")],1),a("br"),s._v(" "),a("a",{attrs:{href:"https://www.jianshu.com/p/5557b6172b97",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.jianshu.com/p/5557b6172b97"),a("OutboundLink")],1),a("br"),s._v(" "),a("a",{attrs:{href:"https://openmediavault.readthedocs.io/en/5.x/installation/on_debian.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://openmediavault.readthedocs.io/en/5.x/installation/on_debian.html"),a("OutboundLink")],1)])],1)}),[],!1,null,null,null);t.default=n.exports}}]);